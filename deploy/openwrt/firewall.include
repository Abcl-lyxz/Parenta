chain input_ssh {
    type filter hook input priority filter;
    tcp dport 22 counter accept comment "Parenta: SSH safety"
}

chain input_parenta {
    type filter hook input priority filter;
    tcp dport 8080 counter accept comment "Parenta: Admin dashboard"
    tcp dport 2050 counter accept comment "Parenta: OpenNDS captive portal"
}

set parenta_doh_servers {
    type ipv4_addr
    flags interval
    elements = { 
        8.8.8.8, 8.8.4.4,
        1.1.1.1, 1.0.0.1,
        9.9.9.9, 149.112.112.112,
        208.67.222.222, 208.67.220.220,
        45.90.28.0, 45.90.30.0,
        94.140.14.14, 94.140.15.15,
        185.228.168.168, 185.228.169.168
    }
}

chain forward_parenta_guest {
    type filter hook forward priority filter;
    
    tcp dport 853 counter reject with tcp reset
    udp dport 853 counter drop
    
    ip daddr @parenta_doh_servers tcp dport 443 counter reject with tcp reset
    
    udp dport 443 counter drop comment "Parenta: Block QUIC/HTTP3"
}

chain dstnat_parenta_guest {
    type nat hook prerouting priority dstnat;
    ip daddr != 192.168.2.1 udp dport 53 counter dnat to 192.168.2.1:53
    ip daddr != 192.168.2.1 tcp dport 53 counter dnat to 192.168.2.1:53
}